# ğŸ˜„ 2.CompletableFuture

## CompletableFutureåŸºæœ¬ä»‹ç» <a href="#cepig" id="cepig"></a>

* é˜»å¡çš„æ–¹å¼å’Œå¼‚æ­¥ç¼–ç¨‹çš„è®¾è®¡ç†å¿µç›¸è¿èƒŒï¼Œè€Œè½®è¯¢çš„æ–¹å¼ä¼šæ¶ˆè€—æ— ç•çš„CPUèµ„æºã€‚å› æ­¤ï¼ŒJDK8è®¾è®¡å‡ºCompletableFuture

### CompletableFuture <a href="#kxzdn" id="kxzdn"></a>



<figure><img src=".gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

* åœ¨Java 8ä¸­ï¼Œ CompletableFutureæä¾›äº†éå¸¸å¼ºå¤§çš„Futureçš„æ‰©å±•åŠŸèƒ½ï¼Œ å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œ å¹¶ä¸”æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œ å¯ä»¥é€šè¿‡å›è°ƒçš„æ–¹å¼å¤„ç†è®¡ç®—ç»“æœï¼Œ ä¹Ÿæä¾›äº†è½¬æ¢å’Œç»„åˆComplet able Futureçš„æ–¹æ³•
* å®ƒå¯èƒ½ä»£è¡¨ä¸€ä¸ªæ˜ç¡®å®Œæˆçš„Futureï¼Œ ä¹Ÿæœ‰å¯èƒ½ä»£è¡¨ä¸€ä¸ªå®Œæˆé˜¶æ®µ(Completion Stage) ï¼Œ å®ƒæ”¯æŒåœ¨è®¡ç®—å®Œæˆä»¥åè§¦å‘ä¸€äº›å‡½æ•°æˆ–æ‰§è¡ŒæŸäº›\
  åŠ¨ä½œã€‚
* å®ƒå®ç°äº†<mark style="color:yellow;">Future</mark>å’Œ<mark style="color:yellow;">Completion Stage</mark>æ¥å£



```java
        CompletableFuture<Void> voidCompletableFuture = CompletableFuture.runAsync(() -> {
            System.out.println("çº¿ç¨‹ ï¼š " + Thread.currentThread().getName());

            try {
                TimeUnit.SECONDS.sleep(5);//æš‚åœå‡ ç§’
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        System.out.println("voidCompletableFuture = " + voidCompletableFuture.get());
    }

==========é»˜è®¤çº¿ç¨‹æ± =============
çº¿ç¨‹ ï¼š ForkJoinPool.commonPool-worker-1 é»˜è®¤çº¿ç¨‹æ± 
voidCompletableFuture = null
```



**2 runAsync+çº¿ç¨‹æ± **

```java
public static CompletableFuture<Void> runAsync(Runnable runnable,
                                                   Executor executor)

```







```java
    ExecutorService threadPool = Executors.newFixedThreadPool(1);
        CompletableFuture<Void> voidCompletableFuture = CompletableFuture.runAsync(() -> {
            System.out.println("çº¿ç¨‹ ï¼š " + Thread.currentThread().getName());
            try {
                TimeUnit.SECONDS.sleep(5);//æš‚åœå‡ ç§’
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        },threadPool);
        System.out.println("voidCompletableFuture = " + voidCompletableFuture.get());
```

#### supplyAsyncæœ‰è¿”å›å€¼ <a href="#lo1f1" id="lo1f1"></a>

**3 supplyAsync**

```java
public static <U> CompletableFuture<U> supplyAsync(Supplier<U> supplier) 

```

```java
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        CompletableFuture<Integer> voidCompletableFuture = CompletableFuture.supplyAsync(() -> {
            System.out.println("çº¿ç¨‹ ï¼š " + Thread.currentThread().getName());
            int result = 0;
            try {
                TimeUnit.SECONDS.sleep(5);//æš‚åœå‡ ç§’
                 result = ThreadLocalRandom.current().nextInt(10);//äº§ç”Ÿä¸€ä¸ªéšæœºæ•°
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return result;
        });
        System.out.println("ç»“æœ = " + voidCompletableFuture.get());
    }
//é»˜è®¤çº¿ç¨‹
çº¿ç¨‹ ï¼š ForkJoinPool.commonPool-worker-1
ç»“æœ = 6
```

**4 supplyAsync+çº¿ç¨‹æ± **

```java
public static <U> CompletableFuture<U> supplyAsync(Supplier<U> supplier,
                                                       Executor executor)
```



```java
    public static void main(String[] args) throws ExecutionException, InterruptedException {

        ExecutorService threadPool = Executors.newFixedThreadPool(1);
        CompletableFuture<Integer> voidCompletableFuture = CompletableFuture.supplyAsync(() -> {
            System.out.println("çº¿ç¨‹ ï¼š " + Thread.currentThread().getName());
            int result = 0;
            try {
                TimeUnit.SECONDS.sleep(5);//æš‚åœå‡ ç§’
                 result = ThreadLocalRandom.current().nextInt(10);//äº§ç”Ÿä¸€ä¸ªéšæœºæ•°
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return result;
        },threadPool);
        System.out.println("ç»“æœ = " + voidCompletableFuture.get());
        //é‡Šæ”¾èµ„æº
        if (threadPool!=null){
            threadPool.shutdown();
        }
    }
æŒ‡å®šçº¿ç¨‹æ± 
çº¿ç¨‹ ï¼š pool-1-thread-1
ç»“æœ = 9
```

### CompletableFutureä½¿ç”¨æ¼”ç¤ºï¼ˆæ—¥å¸¸ä½¿ç”¨ï¼‰ <a href="#izsvn" id="izsvn"></a>

#### å‡å°‘é˜»å¡å’Œè½®è¯¢whenComplete <a href="#zdosd" id="zdosd"></a>

* CompletableFutureé€šè¿‡whenCompleteæ¥**å‡å°‘é˜»å¡å’Œè½®è¯¢**ï¼ˆè‡ªåŠ¨å›è°ƒï¼‰

```java
        CompletableFuture<Integer> exceptionally = CompletableFuture.supplyAsync(() -> {
            System.out.println("çº¿ç¨‹ ï¼š " + Thread.currentThread().getName());
            int result = ThreadLocalRandom.current().nextInt(10);//äº§ç”Ÿä¸€ä¸ªéšæœºæ•°

            try {
                TimeUnit.SECONDS.sleep(5);//æš‚åœå‡ ç§’
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return result;
        }).whenComplete((v, e) -> {//æ²¡æœ‰å¼‚å¸¸,væ˜¯å€¼ï¼Œeæ˜¯å¼‚å¸¸
            if (e == null) {
                System.out.println("ä»»åŠ¡æ‰§è¡Œç»“æœ = " + v);
            }
        }).exceptionally(e -> {//æœ‰å¼‚å¸¸çš„æƒ…å†µ
            e.printStackTrace();
            System.out.println("å¼‚å¸¸æƒ…å†µ" + e.getCause() + "\t" + e.getMessage());
            return null;
        });

        //çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­ï¼šæš‚åœ3ç§’é’Ÿçº¿ç¨‹
        System.out.println(Thread.currentThread().getName()+"çº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡");
        try {
            TimeUnit.SECONDS.sleep(5);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }


çº¿ç¨‹ ï¼š ForkJoinPool.commonPool-worker-1
mainçº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡
ä»»åŠ¡æ‰§è¡Œç»“æœ = 6
```

å¼‚å¸¸æƒ…å†µçš„å±•ç¤ºï¼Œè®¾ç½®ä¸€ä¸ªå¼‚å¸¸ int i = 10 / 0 ;

```java
      CompletableFuture<Integer> exceptionally = CompletableFuture.supplyAsync(() -> {
            System.out.println("çº¿ç¨‹ ï¼š " + Thread.currentThread().getName());
            int result = ThreadLocalRandom.current().nextInt(10);//äº§ç”Ÿä¸€ä¸ªéšæœºæ•°

            try {
                TimeUnit.SECONDS.sleep(5);//æš‚åœå‡ ç§’
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            if(result > 2){
                int i  = 10 / 0 ;//æˆ‘ä»¬ä¸»åŠ¨çš„ç»™ä¸€ä¸ªå¼‚å¸¸æƒ…å†µ
            }
            return result;
        }).whenComplete((v, e) -> {//æ²¡æœ‰å¼‚å¸¸,væ˜¯å€¼ï¼Œeæ˜¯å¼‚å¸¸
            if (e == null) {
                System.out.println("ä»»åŠ¡æ‰§è¡Œç»“æœ = " + v);
            }
        }).exceptionally(e -> {//æœ‰å¼‚å¸¸çš„æƒ…å†µ
            e.printStackTrace();
            System.out.println("å¼‚å¸¸æƒ…å†µ" + e.getCause() + "\t" + e.getMessage());
            return null;
        });

        //çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­ï¼šæš‚åœ3ç§’é’Ÿçº¿ç¨‹
        System.out.println(Thread.currentThread().getName()+"çº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡");
        try {
            TimeUnit.SECONDS.sleep(5);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }


çº¿ç¨‹ ï¼š ForkJoinPool.commonPool-worker-1
mainçº¿ç¨‹å…ˆå»å¿™å…¶ä»–ä»»åŠ¡
java.util.concurrent.CompletionException: java.lang.ArithmeticException: / by zero
	at java.base/java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315)
	at java.base/java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:320)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run$$$capture(CompletableFuture.java:1770)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec$$$capture(ForkJoinTask.java:373)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)
Caused by: java.lang.ArithmeticException: / by zero
	at cn.iocoder.yudao.module.pay.service.merchant.PayAppServiceTest.lambda$main$25(PayAppServiceTest.java:255)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run$$$capture(CompletableFuture.java:1768)
	... 8 more
å¼‚å¸¸æƒ…å†µjava.lang.ArithmeticException: / by zero	java.lang.ArithmeticException: / by zero
```

### CompletableFutureä¼˜ç‚¹æ€»ç»“ <a href="#lr4kc" id="lr4kc"></a>

* å¼‚æ­¥ä»»åŠ¡ç»“æŸæ—¶ï¼Œä¼š**è‡ªåŠ¨å›è°ƒ**æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼›
* ä¸»çº¿ç¨‹è®¾ç½®å¥½æ¯æ‰åï¼Œä¸å†å…³å¿ƒå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œå¼‚æ­¥ä»»åŠ¡ä¹‹é—´å¯ä»¥é¡ºåºæ‰§è¡Œ
* å¼‚æ­¥ä»»åŠ¡å‡ºé”™æ—¶ï¼Œä¼šè‡ªåŠ¨å›è°ƒæŸä¸ªå¯¹è±¡çš„æ–¹æ³•

## CompletableFutureæ¡ˆä¾‹ç²¾è®² <a href="#u8ao9" id="u8ao9"></a>

### ç¼–ç¨‹å¿…å¤‡æŠ€èƒ½å‡†å¤‡ <a href="#sxelo" id="sxelo"></a>

#### å‡½æ•°å¼æ¥å£ <a href="#slylz" id="slylz"></a>

* **å‡½æ•°å¼æ¥å£**çš„å®šä¹‰
* ä»»ä½•**æ¥å£**ï¼Œå¦‚æœåªåŒ…å«**å”¯ä¸€ä¸€ä¸ª**æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª**å‡½æ•°å¼æ¥å£**ã€‚å¯¹äºå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**lambdaè¡¨è¾¾å¼**æ¥åˆ›å»ºè¯¥æ¥å£çš„å¯¹è±¡ã€‚

```java
public interface Runnable{
  public abstract void run();
}

```

å¸¸è§çš„å‡½æ•°å¼æ¥å£

* Runnable

```java
@FunctionalInterface
public interface Runnable {
    public abstract void run();
}

```

* Function

```java
@FunctionalInterface
public interface Function<T, R> {
    R apply(T t);
}

```

* Consumer

```java


@FunctionalInterface
public interface Consumer<T> {
    void accept(T t);
}

```

Supplier

```
@FunctionalInterface
public interface Supplier<T> {

    /**
     * Gets a result.
     *
     * @return a result
     */
    T get();
}
```

* Biconsumer(Biä»£è¡¨ä¸¤ä¸ªçš„æ„æ€ï¼Œæˆ‘ä»¬è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­æ˜¯vå’Œe)\


| **å‡½æ•°å¼æ¥å£åç§°** | **æ–¹æ³•åç§°** | **å‚æ•°** | **è¿”å›å€¼** |
| ----------- | -------- | ------ | ------- |
| Runnable    | run      | æ— å‚æ•°    | æ— è¿”å›å€¼    |
| Function    | apply    | 1ä¸ªå‚æ•°   | æœ‰è¿”å›å€¼    |
| Consume     | accept   | 1ä¸ªå‚æ•°   | æ— è¿”å›å€¼    |
| Supplier    | get      | æ²¡æœ‰å‚æ•°   | æœ‰è¿”å›å€¼    |
| Biconsumer  | accept   | 2ä¸ªå‚æ•°   | æ— è¿”å›å€¼    |

#### é“¾å¼è°ƒç”¨|é“¾å¼ç¼–ç¨‹|é“¾å¼å†™æ³• <a href="#khg6e" id="khg6e"></a>

```java
public class Chain {
    public static void main(String[] args) {
        //-------------------è€å¼å†™æ³•------------
//        Student student = new Student();
//        student.setId(1);
//        student.setMajor("cs");
//        student.setName("å°å¡");
        new Student().setId(1).setName("å¤§å¡").setMajor("cs");
    }
    
}

@NoArgsConstructor
@AllArgsConstructor
@Data
@Accessors(chain = true)//å¼€å¯é“¾å¼ç¼–ç¨‹
class Student{
    private int id;
    private String name;
    private String major;
}
```

#### joinå’Œgetå¯¹æ¯” <a href="#muvsx" id="muvsx"></a>

* åŠŸèƒ½å‡ ä¹ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºç¼–ç æ—¶æ˜¯å¦éœ€è¦æŠ›å‡ºå¼‚å¸¸
*
  * get()æ–¹æ³•éœ€è¦æŠ›å‡ºå¼‚å¸¸
  * join()æ–¹æ³•ä¸éœ€è¦æŠ›å‡ºå¼‚å¸¸

```java
public class Chain {
    public static void main(String[] args) throws ExecutionException, InterruptedException {//æŠ›å‡ºå¼‚å¸¸
        CompletableFuture<String> completableFuture = CompletableFuture.supplyAsync(() -> {
            return "hello 12345";
        });
        System.out.println(completableFuture.get());
    }

}

public class Chain {
    public static void main(String[] args)  {//æŠ›å‡ºå¼‚å¸¸
        CompletableFuture<String> completableFuture = CompletableFuture.supplyAsync(() -> {
            return "hello 12345";
        });
        System.out.println(completableFuture.join());
    }
}

```

### å®æˆ˜ç²¾è®²-æ¯”ä»·ç½‘ç«™case <a href="#ydl6t" id="ydl6t"></a>

#### éœ€æ±‚ <a href="#mwdvw" id="mwdvw"></a>

```html
1éœ€æ±‚è¯´æ˜
1.1åŒä¸€æ¬¾äº§å“ï¼ŒåŒæ—¶æœç´¢å‡ºåŒæ¬¾äº§å“åœ¨å„å¤§ç”µå•†å¹³å°çš„å”®ä»·ï¼›
1.2åŒä¸€æ¬¾äº§å“ï¼ŒåŒæ—¶æœç´¢å‡ºæœ¬äº§å“åœ¨åŒä¸€ä¸ªç”µå•†å¹³å°ä¸‹ï¼Œå„ä¸ªå…¥é©»å–å®¶å”®ä»·æ˜¯å¤šå°‘

2è¾“å‡ºè¿”å›ï¼š
å‡ºæ¥ç»“æœå¸Œæœ›æ˜¯åŒæ¬¾äº§å“çš„åœ¨ä¸åŒåœ°æ–¹çš„ä»·æ ¼æ¸…å•åˆ—è¡¨ï¼Œ è¿”å›ä¸€ä¸ªList<String>
ã€Šmysqlã€‹in jd price is 88.05
ã€Šmysqlã€‹in dang dang price is 86.11
ã€Šmysqlã€‹in tao bao price is 90.43

3è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¯¹åŒä¸€ä¸ªå•†å“åœ¨å„ä¸ªå¹³å°ä¸Šçš„ä»·æ ¼ï¼Œè¦æ±‚è·å¾—ä¸€ä¸ªæ¸…å•åˆ—è¡¨
1   stepbystep   ï¼Œ æŒ‰éƒ¨å°±ç­ï¼Œ æŸ¥å®Œäº¬ä¸œæŸ¥æ·˜å®ï¼Œ æŸ¥å®Œæ·˜å®æŸ¥å¤©çŒ«......
2   all in       ï¼Œä¸‡ç®­é½å‘ï¼Œä¸€å£æ°”å¤šçº¿ç¨‹å¼‚æ­¥ä»»åŠ¡åŒæ—¶æŸ¥è¯¢ã€‚ã€‚ã€‚
```

#### åŸºæœ¬æ¡†æ¶æ­å»º <a href="#oylii" id="oylii"></a>

* ç›¸å½“äºæ˜¯ä¸€ä¸ªä¸€ä¸ªæŒ‰éƒ¨å°±ç­

```java
public class CaseDemo {
    static List<NetMall> list = Arrays.asList(
            new NetMall("jd"),
            new NetMall("dangdang"),
            new NetMall("taobao")
    );

    public static List<String> getPrice(List<NetMall> list,String productName){
        return list
                .stream() //----æµå¼è®¡ç®—åšäº†æ˜ å°„ï¼ˆåˆ©ç”¨mapï¼‰ï¼Œå¸Œæœ›å‡ºæ¥çš„æ˜¯æœ‰æ ¼å¼çš„å­—ç¬¦ä¸²ï¼ˆåˆ©ç”¨String.formatï¼‰,%æ˜¯å ä½ç¬¦
                .map(netMall -> String.format(productName + " in %s price is %.2f",
                        netMall.getNetMallName(),//ç¬¬ä¸€ä¸ª%
                        netMall.calcPrice(productName))).collect(Collectors.toList());//ç¬¬äºŒä¸ª%
    }

    //ä»åŠŸèƒ½åˆ°æ€§èƒ½
    public static List<String> getPricesByCompletableFuture(List<NetMall> list,String productName){
        return list.stream().map(netMall ->
                        CompletableFuture.supplyAsync(() -> String.format(productName + " in %s price is %.2f",
                                netMall.getNetMallName(),
                                netMall.calcPrice(productName))))//Stream<CompletableFuture<String>>
                .collect(Collectors.toList())//List<CompletablFuture<String>>
                .stream()//Stream<CompletableFuture<String>
                .map(s->s.join())//Stream<String>
                .collect(Collectors.toList());
    }

    public static void main(String[] args) {
        long startTime = System.currentTimeMillis();
        List<String> list1 = getPrice(list, "è®¾è®¡æ¨¡å¼");
        for(String element:list1){
            System.out.println(element);
        }
        long endTime = System.currentTimeMillis();
        System.out.println("--æ™®é€šç‰ˆ----å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:"+(endTime-startTime)+"æ¯«ç§’");
        System.out.println("------------------------------åˆ†å‰²----------------------");
        startTime = System.currentTimeMillis();
        List<String> list2 = getPricesByCompletableFuture(list, "è®¾è®¡æ¨¡å¼");
        for(String element:list2){
            System.out.println(element);
        }
        endTime = System.currentTimeMillis();
        System.out.println("--æ€§èƒ½ç‰ˆ-å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:"+(endTime-startTime)+"æ¯«ç§’");
    }
}

class NetMall{
    @Getter
    private String netMallName;

    public NetMall(String netMallName){
        this.netMallName = netMallName;
    }

    public double calcPrice(String productName){
        try {
            TimeUnit.SECONDS.sleep(1);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return ThreadLocalRandom.current().nextDouble() * 2 + productName.charAt(0);//ç”¨è¿™å¥è¯æ¥æ¨¡æ‹Ÿä»·æ ¼
    }
}
//    è®¾è®¡æ¨¡å¼ in jd price is 35774.22
//        è®¾è®¡æ¨¡å¼ in dangdang price is 35774.31
//        è®¾è®¡æ¨¡å¼ in taobao price is 35775.29
//        --æ™®é€šç‰ˆ----å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:3036æ¯«ç§’
//        ------------------------------åˆ†å‰²----------------------
//        è®¾è®¡æ¨¡å¼ in jd price is 35774.82
//        è®¾è®¡æ¨¡å¼ in dangdang price is 35774.13
//        è®¾è®¡æ¨¡å¼ in taobao price is 35775.44
//        --æ€§èƒ½ç‰ˆ-å½“å‰æ“ä½œèŠ±è´¹æ—¶é—´----costTime:1023æ¯«ç§’
```

\


## CompletableFutureå¸¸ç”¨API <a href="#illdo" id="illdo"></a>

* getNowè°ƒç”¨çš„æ—¶å€™å¦‚æœè®¡ç®—å®Œäº†ï¼Œå°±æ‹¿å–è¿™ä¸ªè®¡ç®—å®Œçš„å€¼ï¼›å¦åˆ™å°±æ‹¿**å¤‡èƒå€¼**

\
\
\


### 1.è·å¾—ç»“æœå’Œè§¦å‘è®¡ç®— <a href="#mwgb7" id="mwgb7"></a>

è·å–ç»“æœ

* public T get() ä¸è§ä¸æ•£ï¼Œå®¹æ˜“é˜»å¡
* public T get(long timeout,TimeUnit unit) è¿‡æ—¶ä¸å€™ï¼Œè¶…è¿‡æ—¶é—´ä¼šçˆ†å¼‚å¸¸
* public T join() ç±»ä¼¼äºget()ï¼ŒåŒºåˆ«åœ¨äºæ˜¯å¦éœ€è¦æŠ›å‡ºå¼‚å¸¸
* public T getNow(T valueIfAbsent)
* æ²¡æœ‰è®¡ç®—å®Œæˆçš„æƒ…å†µä¸‹ï¼Œç»™ä¸€ä¸ªæ›¿ä»£ç»“æœ
* ç«‹å³è·å–ç»“æœä¸é˜»å¡
*
  * è®¡ç®—å®Œï¼Œè¿”å›è®¡ç®—å®Œæˆåçš„ç»“æœ
  * æ²¡ç®—å®Œï¼Œè¿”å›è®¾å®šçš„valueAbsent(ç›´æ¥è¿”å›äº†å¤‡èƒå€¼xxx)

ä¸»åŠ¨è§¦å‘è®¡ç®—

* public boolean complete(T value) æ˜¯å¦ç«‹å³æ‰“æ–­get()æ–¹æ³•è¿”å›æ‹¬å·å€¼
* (æ‰§è¡Œè¦2sï¼Œç­‰å¾…åªæœ‰1sï¼Œæ‰€ä»¥è¿˜æ²¡æ‰§è¡Œå®Œå°±è¢«æ‰“æ–­äº†ã€‚è¿”å›trueè¡¨ç¤ºæ‰“æ–­äº†è·å–è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´æ¥è¿”å›äº†å¤‡èƒå€¼completeï¼›å¦‚æœæ²¡æ‰“æ–­ï¼Œè¿”å›false å’ŒåŸæ¥çš„abc)

```java
public class CompletableFutureAPIDemo {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        CompletableFuture<String> uCompletableFuture = CompletableFuture.supplyAsync(() -> {
            try {
                TimeUnit.SECONDS.sleep(2);//æ‰§è¡Œéœ€è¦2ç§’
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return "abc";
        });

        try {
            TimeUnit.SECONDS.sleep(1);//ç­‰å¾…éœ€è¦1ç§’
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
       // System.out.println(uCompletableFuture.getNow("xxx"));//æ‰§2-ç­‰1 è¿”å›xxx
        System.out.println(uCompletableFuture.complete("completeValue")+"\t"+uCompletableFuture.get());//æ‰§2-ç­‰1 è¿”å›true+å¤‡èƒå€¼completeValue
    }
}
```

### 2.å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç† <a href="#ll1p4" id="ll1p4"></a>

* thenApply è®¡ç®—ç»“æœå­˜åœ¨åœ¨ä¾èµ–å…³ç³»ï¼Œä½¿å¾—çº¿ç¨‹ä¸²è¡ŒåŒ–ã€‚å› ä¸ºä¾èµ–\`å…³ç³»ï¼Œæ‰€ä»¥ä¸€æ—¦æœ‰å¼‚å¸¸ï¼Œç›´æ¥å«åœ

```java
    public static void main(String[] args) {
        //å½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ç”¨ thenApply æ–¹æ³•æ¥æŠŠè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡ŒåŒ–,
        CompletableFuture.supplyAsync(() -> {
            //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹
            try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); }
            System.out.println("111");
            return 1024;java
        }).thenApply(f -> {
            System.out.println("222");
            return f + 1;
        }).thenApply(f -> {
            //int age = 10/0; // å¼‚å¸¸æƒ…å†µï¼šé‚£æ­¥å‡ºé”™å°±åœåœ¨é‚£æ­¥ã€‚
            System.out.println("333");
            return f + 1;
        }).whenCompleteAsync((v,e) -> { //æœ€ç»ˆç»“æœ
            System.out.println("æœ€ç»ˆç»“æœ: "+v);
        }).exceptionally(e -> {
            e.printStackTrace();
            return null;
        });

        System.out.println("-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND");

        // ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:
        try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); }
    }


===============
    
-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND
111
222
333
æœ€ç»ˆç»“æœï¼š1026


=========å¼‚å¸¸
-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND
111
222
æœ€ç»ˆç»“æœï¼šnull
java.util.concurrent.CompletionException: java.lang.ArithmeticException: / by zero
	at java.base/java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315)
	at java.base/java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:320)
	at java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:649)
	at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run$$$capture(CompletableFuture.java:1773)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec$$$capture(ForkJoinTask.java:373)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)
Caused by: java.lang.ArithmeticException: / by zero



```

handle ç±»ä¼¼äºthenApplyï¼Œä½†æ˜¯æœ‰å¼‚å¸¸çš„è¯ä»ç„¶å¯ä»¥å¾€ä¸‹èµ°ä¸€æ­¥ã€‚

```java
        //å½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ç”¨ thenApply æ–¹æ³•æ¥æŠŠè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡ŒåŒ–,
        CompletableFuture.supplyAsync(() -> {
            //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹
            try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); }
            System.out.println("111");
            return 1024;
        }).handle((f,e) -> {
            System.out.println("222");
            return f + 1;
        }).handle((f,e) -> {
            int age = 10/0; // å¼‚å¸¸æƒ…å†µï¼šé‚£æ­¥å‡ºé”™å°±åœåœ¨é‚£æ­¥ã€‚
            System.out.println("333");
            return f + 1;
        }).handle((f,e) -> {
            System.out.println("444");
            return f + 1;
        }).whenCompleteAsync((v,e) -> { //æœ€ç»ˆç»“æœ
            System.out.println("æœ€ç»ˆç»“æœï¼š"+v);
        }).exceptionally(e -> {
            e.printStackTrace();
            return null;
        });

        System.out.println("-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND");

        // ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:
        try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); }




//=====
å¼‚å¸¸æƒ…å†µèµ°äº†444
-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND
111
222
444
æœ€ç»ˆç»“æœï¼šnull
```

* ä¸€èˆ¬ç”¨thenApply

### 3.å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹ <a href="#fvw2h" id="fvw2h"></a>

* æ¥æ”¶ä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œå¹¶**æ¶ˆè´¹å¤„ç†ï¼Œæ— è¿”å›ç»“æœ**|**æ¶ˆè´¹å‹å‡½æ•°å¼æ¥å£**ï¼Œä¹‹å‰çš„æ˜¯Function
* thenAccept

```java
   CompletableFuture.supplyAsync(() -> {
            return 1;
        }).thenApply(f -> {
            return f + 2;
        }).thenApply(f -> {
            return f + 3;
        }).thenApply(f -> {
            return f + 4;
        }).thenAccept(r -> System.out.println(r));


========
//æ¶ˆè´¹ä¸€ä¸‹ï¼Œç›´æ¥å¾—åˆ°10
```

è¡¥å……ï¼šCodeä¹‹ä»»åŠ¡ä¹‹é—´çš„é¡ºåºæ‰§è¡Œ

* thenRun
*
  * thenRun(Runnable runnable)
  * ä»»åŠ¡Aæ‰§è¡Œå®Œæ‰§è¡ŒBï¼Œå¹¶ä¸”Bä¸éœ€è¦Açš„ç»“æœ
* thenAccept
*
  * thenAccept(Consumer action)
  * ä»»åŠ¡Aæ‰§è¡Œå®Œæ‰§è¡ŒBï¼ŒBéœ€è¦Açš„ç»“æœï¼Œä½†æ˜¯ä»»åŠ¡Bæ— è¿”å›å€¼
* thenApply
*
  * thenApply(Function fn)
  * ä»»åŠ¡Aæ‰§è¡Œå®Œæ‰§è¡ŒBï¼ŒBéœ€è¦Açš„ç»“æœï¼ŒåŒæ—¶ä»»åŠ¡Bæœ‰è¿”å›å€¼

```java
 
System.out.println(CompletableFuture.supplyAsync(() -> "resultA").thenRun(() -> {}).join());
//null 

System.out.println(CompletableFuture.supplyAsync(() -> "resultA").thenAccept(resultA -> {}).join());
//resultAæ‰“å°å‡ºæ¥çš„ nullå› ä¸ºæ²¡æœ‰è¿”å›å€¼

System.out.println(CompletableFuture.supplyAsync(() -> "resultA").thenApply(resultA -> resultA + " resultB").join());
//resultAresultB è¿”å›å€¼
```

### 4.CompleteFutureå’Œçº¿ç¨‹æ± è¯´æ˜ï¼ˆéå¸¸é‡è¦ï¼‰ <a href="#l2zi6" id="l2zi6"></a>

* ä¸Šé¢çš„å‡ ä¸ªæ–¹æ³•éƒ½æœ‰æ™®é€šç‰ˆæœ¬å’Œ**åé¢åŠ Async**çš„ç‰ˆæœ¬
* ä»¥thenRunå’ŒthenRunAsyncä¸ºä¾‹ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

å…ˆçœ‹ç»“è®º

1. æ²¡æœ‰ä¼ å…¥è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œéƒ½ç”¨é»˜è®¤çº¿ç¨‹æ± ForkJoinPool
2. ä¼ å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± å¦‚æœä½ æ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œä¼ å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± 

*
  * è°ƒç”¨thenRunæ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯ç”¨åŒä¸€ä¸ªçº¿ç¨‹æ± 
*
  * è°ƒç”¨thenRunAsyncæ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä¸ªä»»åŠ¡ä½¿ç”¨çš„æ˜¯**ä½ è‡ªå·±**ä¼ å…¥çš„çº¿ç¨‹æ± ï¼Œç¬¬äºŒä¸ªä»»åŠ¡ä½¿ç”¨çš„æ˜¯**ForkJoinçº¿ç¨‹æ± **

1. ä¹Ÿæœ‰å¯èƒ½å¤„ç†å¤ªå¿«ï¼Œç³»ç»Ÿä¼˜åŒ–åˆ‡æ¢åŸåˆ™ï¼Œç›´æ¥ä½¿ç”¨mainçº¿ç¨‹å¤„ç†ï¼ˆæŠŠsleepå»æ‰ï¼‰

```javascript
//2-1
public class CompletableFutureAPIDemo {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        ExecutorService threadPool = Executors.newFixedThreadPool(5);
        CompletableFuture<Void> completableFuture = CompletableFuture.supplyAsync(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("1å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
            return "abcd";
        },threadPool).thenRun(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("2å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
        }).thenRun(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("3å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
        }).thenRun(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("4å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
        });
    }
}
//1å·ä»»åŠ¡  pool-1-thread-1
//2å·ä»»åŠ¡  pool-1-thread-1
//3å·ä»»åŠ¡  pool-1-thread-1
//4å·ä»»åŠ¡  pool-1-thread-1

```

```java
//2-2
public class CompletableFutureAPIDemo {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        ExecutorService threadPool = Executors.newFixedThreadPool(5);
        CompletableFuture<Void> completableFuture = CompletableFuture.supplyAsync(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("1å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
            return "javaabcd";
        },threadPool).thenRunAsync(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("2å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
        }).thenRun(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("3å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
        }).thenRun(()->{
            try {TimeUnit.MILLISECONDS.sleep(20);} catch (InterruptedException e) {e.printStackTrace();}
            System.out.println("4å·ä»»åŠ¡"+"\t"+Thread.currentThread().getName());
        });
    }
}
//1å·ä»»åŠ¡  pool-1-thread-1
//2å·ä»»åŠ¡  ForkJoinPool.commonPool-worker-9---è¿™é‡Œå¦èµ·ç‚‰ç¶é‡æ–°è°ƒç”¨äº†é»˜è®¤çš„ForkJoinPool
//3å·ä»»åŠ¡  ForkJoinPool.commonPool-worker-9
//4å·ä»»åŠ¡  ForkJoinPool.commonPool-worker-9
```

```java
//CompletableFuture.java 2009è¡Œ
public CompletableFuture<Void> thenRun(Runnable action) {//ä¼ å…¥å€¼æ˜¯ä¸€æ ·çš„
        return uniRunStage(null, action);
    }

    public CompletableFuture<Void> thenRunAsync(Runnable action) {
        return uniRunStage(asyncPool, action);//ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå¼‚æ­¥çš„çº¿ç¨‹æ± asyncPool
    }
```

```java
    //è¿›å…¥asyncPool
    private static final boolean useCommonPool =
        (ForkJoinPool.getCommonPoolParallelism() > 1);//ä¸€èˆ¬å¤§äº1éƒ½æ˜¯æˆç«‹çš„

    /**
     * Default executor -- ForkJoinPool.commonPool() unless it cannot
     * support parallelism.
     */
    private static final Executor asyncPool = useCommonPool ?
        ForkJoinPool.commonPool() : new ThreadPerTaskExecutor();//æ‰€ä»¥è¿™é‡Œä¼šè°ƒç”¨forkJoinçº¿ç¨‹æ± 
```

### 5.å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨ <a href="#dia08" id="dia08"></a>

* applyToEitheræ–¹æ³•ï¼Œå¿«çš„é‚£ä¸ªæŒæƒ

```java
public class CompletableFutureDemo2 {
    public static void main(String[] args) throws ExecutionException, InterruptedException
    {
        CompletableFuture<String> play1 = CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in ");
            //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹
            try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); }
            return "play1 ";
        });

        CompletableFuture<String> play2 = CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in ");
            try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); }
            return "play2";
        });

        CompletableFuture<String> thenCombineResult = play1.applyToEither(play2, f -> {//å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨
            return f + " is winner";
        });

        System.out.println(Thread.currentThread().getName() + "\t" + thenCombineResult.get());
    }
}
//ForkJoinPool.commonPool-worker-9  ---come in 
//ForkJoinPool.commonPool-worker-2  ---come in 
//main  play2 is winner
```

### 6.å¯¹è®¡ç®—ç»“æœè¿›è¡Œåˆå¹¶ <a href="#omxix" id="omxix"></a>

thenCombine åˆå¹¶

* ä¸¤ä¸ªCompletionStageä»»åŠ¡éƒ½å®Œæˆåï¼Œæœ€ç»ˆèƒ½æŠŠä¸¤ä¸ªä»»åŠ¡çš„ç»“æœä¸€èµ·äº¤ç»™thenCOmbineæ¥å¤„ç†
* å…ˆå®Œæˆçš„å…ˆç­‰ç€ï¼Œç­‰å¾…å…¶å®ƒåˆ†æ”¯ä»»åŠ¡

```java
public class CompletableFutureDemo2
{
    public static void main(String[] args) throws ExecutionException, InterruptedException
    {
        CompletableFuture<Integer> completableFuture1 = CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in ");
            return 10;
        });

        CompletableFuture<Integer> completableFuture2 = CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in ");
            return 20;
        });

        CompletableFuture<Integer> thenCombineResult = completableFuture1.thenCombine(completableFuture2, (x, y) -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in ");
            return x + y;
        });
        
        System.out.println(thenCombineResult.get());
    }
}
//30
```

* åˆå¹¶ç‰ˆæœ¬

```java
public class CompletableFutureDemo2
{
    public static void main(String[] args) throws ExecutionException, InterruptedException
    {
        CompletableFuture<Integer> thenCombineResult = CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in 1");
            return 10;
        }).thenCombine(CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in 2");
            return 20;
        }), (x,y) -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in 3");
            return x + y;
        }).thenCombine(CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in 4");
            return 30;
        }),(a,b) -> {
            System.out.println(Thread.currentThread().getName() + "\t" + "---come in 5");
            return a + b;
        });
        System.out.println("-----ä¸»çº¿ç¨‹ç»“æŸï¼ŒEND");
        System.out.println(thenCombineResult.get());


        // ä¸»çº¿ç¨‹ä¸è¦ç«‹åˆ»ç»“æŸï¼Œå¦åˆ™CompletableFutureé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ± ä¼šç«‹åˆ»å…³é—­:
        try { TimeUnit.SECONDS.sleep(10); } catch (InterruptedException e) { e.printStackTrace(); }
    }
}
```





é—®é¢˜ï¼šåœ¨ä¸€å¤§å †ä»»åŠ¡ä¸­ï¼Œå¦‚ä½•è·å–ç¬¬ä¸€ä¸ªå®Œæˆçš„è¿”å›å€¼ï¼Ÿ



```java
public class CompletableFutureTest {
    @Test
    public void test() throws ExecutionException, InterruptedException {
        ExecutorService executorService = Executors.newFixedThreadPool(5);
        FutureTask<Integer> futureTask = new FutureTask<>(new Task());

        executorService.submit(futureTask);
        System.out.println("FutureTask...");
        System.out.println(futureTask.get());
        System.out.println("FutureTask done.");

        List<Future<Integer>> futures = new ArrayList<>();
        for (int i = 0; i < 20; i++) {
            futures.add(executorService.submit(new Task()));
        }
        executorService.shutdown();
        while (!executorService.isTerminated()) {
        }

        for (Future<Integer> future : futures) {
            if (future.isDone()) {
                System.out.println(future.get());
            }
        }
        CompletableFuture.runAsync(() -> System.out.println(""));
        System.out.println("All tasks were done.");
    }

    public static class Task implements Callable<Integer> {
        @Override
        public Integer call() throws Exception {
            int second = 0;
            try {
                ThreadLocalRandom random = ThreadLocalRandom.current();
                second = random.nextInt(10000);
                Thread.sleep(second);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return second;
        }
    }

}s
```

















